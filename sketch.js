var runrightAnimation;
var runleftAnimation;
var bobImage;

var TILESIZE;
var groundGroup;

var gamestate = "title";

var groundcheck;
var la = 0;
var lo = 0;

var jumpcount = 0;
var level = 1;
var a = 0;
var b = 0;
var c = 0;
var d = 0;
var e = 0;
var f = 0;
var g = 0;

var x1;
var y1;
var x2;
var y2;
var x3;
var y3;
var x4;
var y4;
var x5;
var y5;

var woodCount = 0;
var addWood = 0;

var goldCount = 0;
var addGold = 0;

var lerpr = false;
var lerpl = false;

var levelp = 1;

var bob;

var answered1 = false;
var bonus1 = false;

function preload() {
    runrightAnimation = loadAnimation("img/run1.png", "img/run2.png", 
                                    "img/run3.png", "img/run4.png", 
                                    "img/run5.png", "img/run6.png", 
                                    "img/run7.png", "img/run8.png");
    runleftAnimation = loadAnimation("img/run1l.png", "img/run2l.png", 
                                    "img/run3l.png", "img/run4l.png", 
                                    "img/run5l.png", "img/run6l.png", 
                                    "img/run7l.png", "img/run8l.png");
    crouching = loadAnimation("img/crouch1.png", "img/crouch2.png");
    bobImage = loadAnimation("img/bob.png");

    world1 = loadImage("img/world-1-2.png");
    pinImg = loadImage("img/pin.png");

    mountainImg = loadImage("img/mountainbackground.png");
}

function setup() {
    canvas = createCanvas(displayWidth - 100, displayHeight - 140);
    console.log(displayHeight);
    console.log(displayWidth);
    pin = createSprite((displayWidth - 100) / 4.58, (displayHeight - 100) / 1.4384);
    pin.addImage(pinImg);
    pin.scale = 0.2;
    playButton = createButton("PLAY");
    playButton.size(200, 100);
    playButton.style("font-size", 40 + "pt");
    playButton.style("border-radius", 25);
    playButton.style("background-color", "gold");
    playButton.position(width / 2 - 100, height / 2 + 200);
}

function draw() {
    background(255);

    if (woodCount < addWood) {
        woodCount += 1;
    }
    if (goldCount < addGold) {
        goldCount += 1;
    }

    if (gamestate == "title") {
        pin.visible = false;
        image(mountainImg, 0, 0, width, height);
        textSize(105);
        fill(255, 215, 0);
        textAlign(CENTER, CENTER);
        text("BOB'S", width / 2, height / 2 - 350);
        text("ADVENTURES", width / 2, height / 2 - 250);
        playButton.mousePressed(function () {
            gamestate = "start";
            playButton.hide();
        })
    }

    if (gamestate == "start") {
        push();
        pin.visible = true;
        image(world1, 0, 0, width, height + displayHeight / 2.25);

        x1 = (displayWidth - 100) / 4.58;
        y1 = (displayHeight - 100) / 1.4384;
        x2 = (displayWidth - 100) / 3.9308;
        y2 = (displayHeight - 100) / 1.2793;
        x3 = (displayWidth - 100) / 3.2098;
        y3 = (displayHeight - 100) / 1.1638;
        x4 = (displayWidth - 100) / 2.6491;
        y4 = (displayHeight - 100) / 1.1708;
        x5 = (displayWidth - 100) / 2.4528;
        y5 = (displayHeight - 100) / 1.1316;

        bonus1x = (displayWidth - 100) / 2.4897;
        bonus1y = (displayHeight - 100) / 1.3369;

        camx = pin.x;
        camy = pin.y;

        if (level > 0) {
            if (a < 255) {
                a += 5;
            }
            if (level <= 1) {
                fill(0, 0, 0, a);
                stroke(0, 0, 0);
            }
            else {
                fill(255, 215, 0, a);
                stroke(255, 215, 0);
            }
            ellipse1 = ellipse(x1, y1, 10);
        }

        if (level > 1) {
            if (b < 255) {
                b += 5;
            }

            if (level <= 2) {
                fill(0, 0, 0, a);
                stroke(0, 0, 0);
            }
            else {
                fill(255, 215, 0, a);
                stroke(255, 215, 0);
            }
            ellipse2 = ellipse(x2, y2, 10);
            line(x1, y1, x2, y2);
        }
        if (level > 2) {
            if (c < 255) {
                c += 5;
            }

            if (level <= 3) {
                fill(0, 0, 0, a);
                stroke(0, 0, 0);
            }
            else {
                fill(255, 215, 0, a);
                stroke(255, 215, 0);
            }
            ellipse3 = ellipse(x3, y3, 10);
            line(x2, y2, x3, y3);
        }
        if (level > 3) {
            if (d < 255) {
                d += 5;
            }

            if (level <= 4) {
                fill(0, 0, 0, a);
                stroke(0, 0, 0);
            }
            else {
                fill(255, 215, 0, a);
                stroke(255, 215, 0);
            }
            ellipse4 = ellipse(x4, y4, 10);
            line(x3, y3, x4, y4);
        }
        if (level > 4) {
            if (e < 255) {
                e += 1;
            }

            if (level <= 5) {
                fill(0, 0, 0, a);
                stroke(0, 0, 0);
            }
            else {
                fill(255, 215, 0, a);
                stroke(255, 215, 0);
            }
            ellipse5 = ellipse(bonus1x, bonus1y, 10);
            line(x4, y4, bonus1x, bonus1y);
            ellipse6 = ellipse(x5, y5, 10);
            line(x4, y4, x5, y5);
        }

        /*if (pin.x == x2) {
            levelp = 2;
        }

        if (pin.x == x3) {
            levelp = 3;
        }

        if (pin.x == x1) {
            levelp = 1;
        }*/

        if (level == 5) {
            if (answered1 == false) {
                fill(255, 215, 0);
                rectMode(CENTER);
                rect(pin.x, pin.y - height / 5, width / 4, height / 8, 25);
                fill(0, 0, 0);
                textAlign(CENTER);
                text("Now it's time to decide which path to take", pin.x, pin.y - height / 5);
                text("Press 1 if you want to take a bonus path (RISKIER, but greater REWARD)", pin.x, pin.y - height / 6);
                text("Press 2 if you want to continue on the normal path", pin.x, pin.y - height / 7);
                if (keyDown('1')) {
                    answered1 = true;
                    bonus1 = true;
                    lerpr = true;
                }
                if (keyDown('2')) {
                    answered1 = true;
                    bonus1 = false;
                    lerpr = true;
                }
            }
        }

        if (lerpr == true) {
                if (level == 2) {
                    pin.x = lerp(pin.x, x2, 0.05);
                    pin.y = lerp(pin.y, y2, 0.05);
                    levelp = 2;
                }
                if (level == 3) {
                    pin.x = lerp(pin.x, x3, 0.05);
                    pin.y = lerp(pin.y, y3, 0.05);
                    levelp = 3;
                }
                if (level == 4) {
                    pin.x = lerp(pin.x, x4, 0.05);
                    pin.y = lerp(pin.y, y4, 0.05);
                    levelp = 4;
                }
                if (level == 5) {
                    if (answered1 == true) {
                        if (bonus1 == true) {
                            pin.x = lerp(pin.x, bonus1x, 0.05);
                            pin.y = lerp(pin.y, bonus1y, 0.05);
                            levelp = 5;
                        } 
                        else {
                            pin.x = lerp(pin.x, x5, 0.05);
                            pin.y = lerp(pin.y, y5, 0.05);
                            levelp = 5;
                        }
                    }
                }
        }

        if (keyWentDown("RIGHT_ARROW")) {
        }
        /*if (keyWentDown("LEFT_ARROW")) {
            lerpl = true;
            lerpr = false;
        }*/

        camera.position.x = camx;
        camera.position.y = camy;

        if (keyWentDown("SPACE")) {
            console.log(mouseX);
            console.log(mouseY);
            console.log(displayWidth - 100 / mouseX);
            console.log(displayHeight - 100 / mouseY);
        }
        if (keyDown("ENTER")) {
            if (pin.x < x1 < pin.x + 10 || pin.x < x2 < pin.x + 10) {
                gamestate = "play";

                if (levelp == 1) {
                    createLevel(["............................................................1........................................................................................................................1",
                                 "2...........................................................2........................................................................................................................2",
                                 "2...........................................................2........................................................................................................................2",
                                 "2..............................................................................................1...2..................................................................484............2",
                                 "2..................................................................................................2....................................................................3............2",
                                 "2...........................................................2..............................1.......2....................................................................3............2",
                                 "2.................................E.......111111111111......2......................................2....................................................................3............2",
                                 "2...........................................................2...........................1..........2..........................................................11........3............2",
                                 "2...........................111111111111....................2......................................2....................................................................3............2",
                                 "2...........................................................2.........................1............2.....................................................111............3............2",
                                 "2.................1111111....................E..............2.......E..............................2.........E......................................111.................3............2",
                                 "2...........................................................2.................111111...............2....................................................................3............2",
                                 "2......P....................................................2......................................2...................................................................567.....W.....2",
                                 "21111111111111111111111111111111111111111111111111111111111121111111111111111111111111111111111111121111111111111111111.......1111111111111111111111111111.........1111111111111111112",], "Beginner's Cliffs");
                }
                if (levelp == 2) {
                    createLevel(["1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
                                "2...................................................................................................................................................................................2",
                                "2...................................................................................................................................................................................2",
                                "2.....................................................................................................................................................................484...........2",
                                "2.......................................................................................................................................................................3...........2",
                                "2...........................................................................................................1111111.....................................................3...........2",
                                "2.........................................111111111111......................................................2222222.....................................................3...........2",
                                "2...........................................................................................................2222222.....................................................3...........2",
                                "2...........................111111111111...................1111111111.......................................2222222.....................................................3...........2",
                                "2...........................................................................................................2222222.....................................................3...........2",
                                "2...........................................................................................................2222222.....................................................3...........2",
                                "2...........................................................................................................2222222.....................................................3...........2",
                                "2......P...............................................................................................................................................................567....W.....2",
                                "2111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111112"], "LockTin's Laughing Mountains");
                }
                if (levelp == 3) {
                    createLevel(["1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
                                "2...........................2.......................................................................................................................................................2",
                                "2...........................2.......................................................................................................................................................2",
                                "2.....................................................................................................................................................................484...........2",
                                "2.......................................................................................................................................................................3...........2",
                                "2...........................2...............................................................................1111111.....................................................3...........2",
                                "2...........................2.............111111111111......................................................2222222.....................................................3...........2",
                                "2...........................2...............................................................................2222222.....................................................3...........2",
                                "2...........................211111111111...................1111111111.......................................2222222.....................................................3...........2",
                                "2...........................................................................................................2222222.....................................................3...........2",
                                "2...........................................................................................................2222222.....................................................3...........2",
                                "2...........................................................................................................2222222.....................................................3...........2",
                                "2......P...............................................................................................................................................................567....W.....2",
                                "2111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111112"], "Perilous Pinnacle");
                }
                if (levelp == 4) {
                    createLevel(["1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
                                 "2...........................2.......................................................................................................................................................2",
                                 "2...........................2.......................................................................................................................................................2",
                                 "2.....................................................................................................................................................................484...........2",
                                 "2.......................................................................................................................................................................3...........2",
                                 "2...........................2...............................................................................1111111.....................................................3...........2",
                                 "2...........................2.............111111111111......................................................2222222.....................................................3...........2",
                                 "2...........................2...............................................................................2222222.....................................................3...........2",
                                 "2...........................211111111111...................1111111111.......................................2222222.....................................................3...........2",
                                 "2...........................2...............................................................................2222222.....................................................3...........2",
                                 "2...........................2...............................................................................2222222.....................................................3...........2",
                                 "2...........................2...............................................................................2222222.....................................................3...........2",
                                 "2.....P.....................2..........................................................................................................................................567....W.....2",
                                 "2111111111111111111111111111211111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111112"], "Super Summit");
                }
                if (levelp == 5) {
                    if (bonus1 == true) {
                        createLevel(["............................................................1.......................................................................................................................................................................................................................................................1",
                                     "2...........................................................2.........................................................................................................................................................................E................................................................484..........2",
                                     "2...........................................................2............................................................................................................................................................................................................................................3..........2",
                                     "2..............................................................................................1...2....................................................................1..........................................................111111................................................................3..........2",
                                     "2..................................................................................................2....................................................................1................................................................................................................................3..........2",
                                     "2...........................................................2..............................1.......2....................................................................1....................................................111.........................................................................3..........2",
                                     "2.................................E.......111111111111......2......................................2....................................................................1...............................................................................................................HH...............3..........2",
                                     "2...........................................................2...........................1..........2..........................................................11........1.................................................1..............................................................................3..........2",
                                     "2...........................111111111111....................2......................................2....................................................................1................................................................................................................................3..........2",
                                     "2.................2.........................................2.........................1............2.....................................................111............1..............................................1..........................1......E.......................VV......................3..........2",
                                     "2.................2111111....................E..............2.......E..............................2.........E......................................111.................1..............................................................................................HH................................3..........2",
                                     "2.................2.........................................2.................111111...............2....................................................................1..............................................................................11111............................................567....G....2",
                                     "2.......P.........2.........................................2......................................2...................................................................111......E....E.......E.......E........E......................................................................................1111111111111112",
                                     "21111111111111111121111111111111111111111111111111111111111121111111111111111111111111111111111111121111111111111111111.......1111111111111111111111111111.........1111111111111111111111111111111111111111111111111................................................................................................2"], "Greedy For Gold")
                    }
                    else {
                        createLevel(["211111111111111111111111111111111111111111111111111111111D.........................................................2",
                                     "2........................................................D...........................................484...........2",
                                     "2........................................................D.............................................3...........2",
                                     "2........................................................D.............................................3...........2",
                                     "2........................................................D.............................................3...........2",
                                     "2........................................................D.............................................3...........2",
                                     "2........................................................D.............................................3...........2",
                                     "2........................................................D.............................................3...........2",
                                     "2........................................................D.............................................3...........2",
                                     "2........................................................D............................................567.....G....2",
                                     "2DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD1111111111111111111111111111111111111111111111111111111112",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2........................................................2",
                                     "2......P.................................................2",
                                     "2111111111111111111111111111111111111111111111111111111112"], "Corindor's Castle");
                    }
                }
            }
        }
        camera.zoom = 2;
        textSize(20);
        text("Wood: " + woodCount, 10 + (pin.x - width / 4), 20 + (pin.y - height / 4));
        text("Gold: " + goldCount, 150 + (pin.x - width / 4), 20 + (pin.y - height / 4));
        pop();
    }
    if (gamestate == "play") {
        pin.visible = false;
        map.update();
        if (map.timer < 60) {
            map.showTitle();
        }
        if (map.timer == 60) {
            camera.zoom = 1;
            camera.position.x = width / 2;
            camera.position.y = height / 2;
            /*image(mountainImg, -200, -200, 96000, 16000);
            image(mountainImg, 9400, -200, 96000, 16000);*/

            /*var scl = (width / height) / 2;
            bob.addAnimation("crouching", crouching);
            bob.addAnimation("runningright", runrightAnimation);
            bob.addAnimation("runningleft", runleftAnimation);
            bob.addAnimation("standing", bobImage);
            bob.scale = 1 * scl;

            bob.setCollider("rectangle", 0, 0, bob.width - 30, bob.height);*/

            groundGroup = new Group();
            flagpoleGroup = new Group();
            materialGroup = new Group();
            enemyGroup = new Group();

            TILESIZE = height / 10;

            map.loadMap();
        }
        if (map.timer > 60) {
            bob.setCollider("rectangle", 0, 0, bob.width - 30, bob.height);
            camera.zoom = 1;
            camera.position.x = bob.x;
            camera.position.y = bob.y - height / 10;
            imageMode(CORNER);
            image(mountainImg, -200, -200, 9600, 1600);
            image(mountainImg, 9400, -200, 9600, 1600);

            groundcheck += 1;
            
            if (groundcheck == 1) {
                la = bob.y;
            }

            if (keyDown("RIGHT_ARROW")) {
                if (keyDown("DOWN_ARROW")) {
                    bob.changeAnimation("crouching");
                    if (keyDown("SHIFT")) {
                        bob.x += 20;
                    }
                    else {
                        bob.x += 15;
                    }
                }
                else {
                    bob.changeAnimation("runningright");
                    if (keyDown("SHIFT")) {
                        bob.x += 30;
                    }
                    else {
                        bob.x += 20;
                    }
                }
            }
            else if (keyDown("LEFT_ARROW")) {
                bob.changeAnimation("runningleft");
                if (keyDown("SHIFT")) {
                    bob.x -= 30;
                }
                else {
                    bob.x -= 20;
                }
            }
            else {
                bob.changeAnimation("standing");
            }

            /*if(keyWentDown("SPACE")) {
                bob.velocityY -= 13;
            }*/

            if (bob.x > width / 2) {
                camera.position.x = bob.x;
            }
            else {
                camera.position.x = width / 2;
            }
            camera.position.y = bob.y - 200;

            //bob.velocityY += 0.8;

            if (bob.collide(groundGroup)) {
                jumpcount = 0;
                bob.velocityY = 0;
            }
            else if(keyWentDown("SPACE")) {
                if (jumpcount < 2) {
                    bob.velocityY -= 13;
                    jumpcount += 1;
                }
            }
            else {
                bob.velocityY += 0.8;
            }

            if (bob.isTouching(flagpoleGroup)) {
                bob.x += TILESIZE / 2;
                gamestate = "end";
            }

            if (bob.isTouching(enemyGroup)) {
                gamestate = "start";
                if (level == 1) {
                    pin.x = x1;
                    pin.y = y1;
                }
                map.destroy();
            }
        }
    }

    if (gamestate == "end") {
        camera.zoom = 1;
        camera.position.x = bob.x;
        camera.position.y = bob.y - height / 10;
        image(mountainImg, -200, -200, 9600, 1600);
        image(mountainImg, 9400, -200, 9600, 1600);

        map.update();

        bob.velocityX = 0;
        if (bob.isTouching(groundGroup)) {
            bob.velocityY = 0;
            bob.velocityX = 10;
        }
        else {
            bob.velocityY = 4;
        }
        if (bob.isTouching(flagpoleGroup)) {
            bob.velocityY = 4;
        }
        else {
            bob.velocityX = 10;
        }

        if (bob.isTouching(materialGroup)) {
            if (map.score == 'W') {
                addWood += 25;
            }
            if (map.score == 'G') {
                addGold += 10;
            }
            gamestate = "start";
            if (level == 1) {
                pin.x = x1;
                pin.y = y1;
            }
            if (bonus1 == true) {
                bonus1 = false;
            }
            else {
                level += 1;
            }
            map.destroy();
            if (level != 5) {
                lerpr = true;
                lerpl = false;
            }
        }
    }
    console.log(level);
    drawSprites();
}

function createLevel (array, title) {
    map = new Map(array, title);
}